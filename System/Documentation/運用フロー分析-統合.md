---
title: 運用フロー分析-統合
tags: [system, workflow, analysis]
created: 2025-12-30
updated: 2025-12-30
---

# 運用フロー分析 - 統合版

この文書は「運用の分析」と「深掘り分析」を統合し、**現行の SSOT（repo 直下 `handoff.md`）** 前提で再整理したものです。
旧方式（Vault の `System/Documentation/引き継ぎ.md` 前提）の分析は `System/Documentation/archive/` に退避しています。

## 対象範囲（今回の合意）
- `handoff` / `endwork` / `wrapup`
- ツール連携（Claude Code / Codex / Cursor）
- hooks / コマンド / git 連携
- **エラー発生に対する学習**

## 用語定義

### 運用の分析
- **目的**: 現状の運用を短く評価し、次の一手を決める
- **頻度**: セッション終了時 or 週次の軽量レビュー
- **出力**: 「観測 → 影響 → 次の一手」

### 深掘り分析
- **目的**: 繰り返し起きる問題や大きな変更の根本原因を特定し、改善策を設計する
- **頻度**: 問題が反復する時／新しい運用導入時
- **出力**: 原因仮説・代替案・検証計画・運用更新

### エラー発生に対する学習
- **目的**: 失敗や矛盾を運用に反映し、再発を防ぐ
- **対象**: 破綻（記録漏れ/矛盾/ツール間不整合/データ混入/権限エラー など）
- **出力**: ルール・スクリプト・ドキュメントの更新 + 運用更新ログへの記録

---

## 現行の運用フロー（SSOT）

### SSOT
- **SSOT**: 各 repo 直下の `handoff.md`
- **更新**:
  - `handoff quick`（切替時）
  - `endwork`（終了時、`handoff.md` だけコミット）
  - `wrapup`（`git add -p` → `endwork`）

### ログの3層構造（現行）
1. **Handoff（再開ログ）**: `handoff.md`
2. **ツール固有ログ**: `.claude/file-changes.log`、`.cursor/hooks/` など
3. **SSOT（永続知見）**: `Atlas/意思決定.md`, `Atlas/パターン.md`, `Atlas/ガードレール.md`

> 重要: Handoff は「再開の最短経路」、SSOT は「長期の判断資産」。役割が違う。

---

## 運用の分析（軽量）

### 入力（最低限）
- 直近の `handoff.md`（Purpose/Now/Next/Risk）
- `handoff` に記録される Git スナップショット
- 変更があれば `tool-parity-check.sh`

### 観点（最小）
- **整合性**: Purpose/Now と Git スナップショットは矛盾していないか
- **入口の統一**: `handoff` / `endwork` / `wrapup` に収束しているか
- **漏れ**: 記録されるべき変更が `handoff.md` に出ているか

### 出力テンプレ（短く）
```
観測: 〜
影響: 〜
次の一手: 〜
```

---

## 深掘り分析（根本原因）

### いつやるか
- 同じ種類の問題が再発
- ツール/運用の大きな変更（入口追加・SSOT変更など）
- エラー学習が蓄積し、体系化が必要な時

### 6つの観点（現行SSOT版）
1. **記録の定義**: Handoff / ツールログ / SSOT の役割が混ざっていないか
2. **Git 連携**: Handoff とステージングの関係が理解されているか
3. **トリガー適正性**: `handoff` を使うべきタイミングが明確か
4. **トリガーはずれ対応**: 失敗時に検出・復旧できるか
5. **ツール間レベル差**: Claude/Codex/Cursor で入口が統一されているか
6. **チェック観点**: 重要な検証が抜けていないか（例: 署名/権限/データ混入）

### 期待アウトプット
- 原因仮説（1〜3本）
- 改善案（優先度つき）
- 検証計画（どう確かめるか）
- 運用更新ログへの記録

---

## エラー発生に対する学習（Learning Loop）

### エラー例（分類）
- **記録矛盾**: `handoff` の宣言が Git スナップショットと矛盾
- **記録漏れ**: `handoff` 未更新／更新忘れ
- **入口ずれ**: Cursor/Codex で旧入口が使われる
- **Git 不整合**: ステージ/未ステージの誤解
- **データ混入**: `*.csv` / `*.xlsx` の追跡
- **権限/フック失敗**: hooks が動いていない、手順が止まる

### 学習フロー
1. **検知**: 通知・差分・手動レビューで発見
2. **記録**: `handoff.md` に短く残す（その場の最小メモ）
3. **分類**: どのカテゴリのエラーかを特定
4. **一次対応**: 直近の矛盾/漏れを修正
5. **深掘り判断**: 再発性があるかで深掘り分析へ
6. **運用反映**: スクリプト/ルール/ドキュメントを更新
7. **検証**: `tool-parity-check.sh` 等で入口/整合性を確認
8. **履歴化**: `System/Documentation/運用更新ログ.md` に残す

---

## 統合元（アーカイブ）
- `System/Documentation/archive/運用フロー分析-Claude-Code-vs-Codex.md`
- `System/Documentation/archive/運用フロー深掘り分析.md`

## 関連ファイル
- `System/Scripts/handoff`
- `System/Scripts/endwork`
- `System/Scripts/wrapup`
- `System/Scripts/tool-parity-check.sh`
- `System/Documentation/運用更新ログ.md`
